[pytest]
# Root pytest configuration
#
# This repo contains many script-like files under `test/` that are not intended
# to be imported by pytest (some call sys.exit at import-time, require optional
# deps, or assume a specific working directory). To keep CI/local runs reliable,
# we scope discovery to the real test suites.
#
# Legacy tests migrated from tests/ directory (January 2026) are now in test/
# root directory but not included in testpaths to avoid running standalone
# scripts. These can be run individually with: pytest test/test_*.py
#
# Model tests (test/improved/) are gated behind --run-model-tests flag.
# By default, pytest runs only framework tests. Use:
#   pytest --run-model-tests          # Run model tests
#   pytest --update-baselines         # Update performance baselines
#   pytest --cov                      # Generate coverage report

testpaths =
    ipfs_accelerate_py/mcp/tests
    test/api
    test/distributed_testing

python_files = test_*.py
python_classes = Test*
python_functions = test_*

norecursedirs =
    .* venv env .venv
    archive dist build
    test/duckdb_api
    test/doc-builder-test
    test/playwright_screenshots_legacy
    test/playwright_screenshots_functional_legacy

addopts =
    --verbose
    --color=yes
    --durations=10


filterwarnings =
    ignore:websockets\.legacy is deprecated.*:DeprecationWarning
    ignore:websockets\.server\.WebSocketServerProtocol is deprecated.*:DeprecationWarning
    ignore:websockets\.client\.WebSocketClientProtocol is deprecated.*:DeprecationWarning
    ignore:builtin type SwigPy.* has no __module__ attribute:DeprecationWarning
    ignore:builtin type swigvarlink has no __module__ attribute:DeprecationWarning
    ignore:The pynvml package is deprecated.*:FutureWarning

markers =
    webgpu: mark test as requiring WebGPU
    webnn: mark test as requiring WebNN
    cuda: mark test as requiring CUDA
    rocm: mark test as requiring ROCm
    mps: mark test as requiring Apple Metal Performance Shaders
    cpu: mark test as requiring only CPU
    slow: mark test as slow (>30s)
    model: mark test as a model test
    model_test: mark test as a HuggingFace model test (gated behind --run-model-tests)
    hardware: mark test as a hardware test
    api: mark test as an API test
    integration: mark test as an integration test
    distributed: mark test as a distributed test
    browser: mark test as requiring a browser
    benchmark: mark test as a performance benchmark
    text: mark test as using text models
    vision: mark test as using vision models
    audio: mark test as using audio models
    multimodal: mark test as using multimodal models
    flaky: mark test as occasionally failing due to external factors
    asyncio: mark test as using pytest-asyncio
    anyio: mark test as using anyio

xfail_strict = True

log_cli = True
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format = %Y-%m-%d %H:%M:%S

junit_family = xunit2
